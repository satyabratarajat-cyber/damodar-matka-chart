<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Damodar Admin Panel</title>
<style>
body{
  margin:0;
  background:#0b0b0b;
  font-family:'Trebuchet MS',Arial,sans-serif;
}
.admin-wrap{
  max-width:700px;
  margin:20px auto;
}
.box{
  background:#fff;
  border:3px solid purple;
  border-radius:12px;
  padding:20px;
  margin-bottom:20px;
}
h2{
  text-align:center;
  color:purple;
  margin-bottom:15px;
}
.row{
  display:grid;
  grid-template-columns:80px 1fr 1fr 140px;
  gap:10px;
  align-items:center;
  margin-bottom:10px;
}
.row label{font-weight:900;}
input{
  padding:8px;
  font-size:15px;
  text-align:center;
  font-weight:900;
}
button{
  padding:8px 10px;
  background:#c1121f;
  color:#fff;
  font-weight:900;
  border:none;
  border-radius:20px;
  cursor:pointer;
}
.full-btn{
  width:100%;
  padding:12px;
  margin-top:15px;
}
textarea{
  width:100%;
  height:80px;
  margin-top:10px;
}
</style>
</head>
<body>

<!-- ===== ADMIN PASSWORD PROTECTION ===== -->
<script>
(function(){
  const ADMIN_PASSWORD = "damodar@123"; // change password here

  if(sessionStorage.getItem("damodarAdminAuth")==="yes") return;

  const pass = prompt("Enter Admin Password:");
  if(pass === ADMIN_PASSWORD){
    sessionStorage.setItem("damodarAdminAuth","yes");
  }else{
    document.body.innerHTML="";
    alert("Access Denied");
  }
})();
</script>


<div class="admin-wrap">

  <!-- DAILY DISPLAY -->
  <div class="box">
    <h2>Daily Display Data</h2>
    <input id="daily" placeholder="248-67-935" style="width:100%;font-size:18px;" />
    <button class="full-btn" onclick="saveDaily()">Generate Now</button>
    <textarea id="dailyOut" readonly></textarea>
  </div>

  <!-- WEEKLY ENTRY -->
  <div class="box">
    <h2>Weekly Entry</h2>

    <div class="row"><label>MON</label><input id="monA" placeholder="Open" /><input id="monB" placeholder="Close" /></div>
    <div class="row"><label>TUE</label><input id="tueA" /><input id="tueB" /></div>
    <div class="row"><label>WED</label><input id="wedA" /><input id="wedB" /></div>
    <div class="row"><label>THU</label><input id="thuA" /><input id="thuB" /></div>
    <div class="row"><label>FRI</label><input id="friA" /><input id="friB" /></div>
    <div class="row"><label>SAT</label><input id="satA" /><input id="satB" /></div>

    <button class="full-btn" onclick="autoSaveWeek()">Save Week Data</button>
    <button class="full-btn" onclick="generateWeek()">Generate New Week</button>
    <button class="full-btn" style="background:#555;" onclick="deletePreviousNumber()">Delete Previous Number</button>
    <textarea id="weekOut" readonly></textarea>
  </div>
</div>

<script>
// ===== LOAD SAVED DATA ON OPEN (CLEAN) =====
window.addEventListener('load',()=>{
  const dailyInput=document.getElementById('daily');
  const dailyOut=document.getElementById('dailyOut');
  const weekOut=document.getElementById('weekOut');

  const daily=localStorage.getItem('damodarDaily');
  if(daily){
    dailyInput.value=daily;
    dailyOut.value='SAVED: '+daily;
  }

  const week=JSON.parse(localStorage.getItem('damodarWeek')||'[]');
  const days=['mon','tue','wed','thu','fri','sat'];
  days.forEach((d,i)=>{
    if(week[i]){
      document.getElementById(d+'A').value=week[i][0] || '';
      document.getElementById(d+'B').value=week[i][1] || '';
    }
  });
});

const dailyInput=document.getElementById('daily');
const dailyOut=document.getElementById('dailyOut');
const weekOut=document.getElementById('weekOut');

// ===== DAILY SAVE (MANUAL, FIXED + PUBLIC CONNECT) =====
function saveDaily(){
  const v=dailyInput.value.trim();
  if(!v) return alert('Daily empty');
  // save for admin
  localStorage.setItem('damodarDaily',v);
  // save for public page (direct read)
  localStorage.setItem('damodarDailyDisplay',v);
  dailyOut.value='SAVED & FIXED: '+v;
}


// ===== MANUAL DAY SAVE (NO AUTO GENERATE) =====
function saveDay(){
  autoSaveWeek();
}

// ===== AUTO SAVE WEEK (MANUAL DATA ONLY + PUBLIC CONNECT) =====
function autoSaveWeek(){
  const week=[
    [monA.value,monB.value],
    [tueA.value,tueB.value],
    [wedA.value,wedB.value],
    [thuA.value,thuB.value],
    [friA.value,friB.value],
    [satA.value,satB.value]
  ];

  // SAVE UNDO SNAPSHOT BEFORE OVERWRITE
  const prevRaw = JSON.parse(localStorage.getItem('damodarWeek') || 'null');
  const prevFlat = JSON.parse(localStorage.getItem('damodarWeekDisplay') || 'null');
  if(prevRaw && prevFlat){
    localStorage.setItem('damodarWeekUndo', JSON.stringify({ raw: prevRaw, flat: prevFlat }));
  }

  localStorage.setItem('damodarWeek',JSON.stringify(week));

  const flat = week.map(d => (d[0] && d[1]) ? `${d[0]}-${d[1]}` : '');
  localStorage.setItem('damodarWeekDisplay', JSON.stringify(flat));

  weekOut.value='SAVED & FIXED (connected to public)';
}


// ===== WEEK END (LOCK CURRENT WEEK + SAVE TO HISTORY + START NEW) =====
function generateWeek(){
  // 1) save latest edits
  autoSaveWeek();

  const currentFlat = JSON.parse(
    localStorage.getItem('damodarWeekDisplay') || '[]'
  );

  const history = JSON.parse(
    localStorage.getItem('damodarWeeksHistory') || '[]'
  );

  history.push(currentFlat);
  localStorage.setItem('damodarWeeksHistory', JSON.stringify(history));

  ['mon','tue','wed','thu','fri','sat'].forEach(d=>{
    document.getElementById(d+'A').value='';
    document.getElementById(d+'B').value='';
  });

  localStorage.setItem('damodarWeek', JSON.stringify([
    ['',''],['',''],['',''],['',''],['',''],['','']
  ]));

  localStorage.setItem('damodarWeekDisplay', JSON.stringify([
    '','','','','',''
  ]));

  localStorage.removeItem('damodarWeekUndo');

  weekOut.value = 'WEEK LOCKED & NEW WEEK STARTED';
  alert('Week locked. New week started.');
}

// ===== DELETE PREVIOUS NUMBER (UNDO LAST SAVE) =====
function deletePreviousNumber(){
  const undo = JSON.parse(localStorage.getItem('damodarWeekUndo') || 'null');
  if(!undo){
    alert('No previous data to delete');
    return;
  }

  localStorage.setItem('damodarWeek', JSON.stringify(undo.raw));
  localStorage.setItem('damodarWeekDisplay', JSON.stringify(undo.flat));

  const days=['mon','tue','wed','thu','fri','sat'];
  days.forEach((d,i)=>{
    document.getElementById(d+'A').value = undo.raw[i][0] || '';
    document.getElementById(d+'B').value = undo.raw[i][1] || '';
  });

  localStorage.removeItem('damodarWeekUndo');
  weekOut.value='PREVIOUS NUMBER RESTORED';
}
</script>

</body>
</html>
